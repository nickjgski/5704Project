Workaround for #2361

Related bug: https://issuetracker.google.com/issues/149636790 | 2020-02-16 23:14:39 | cc840c9fddb3f4f6677005de18f1fcb387b84064

Revert the debug flag | 2020-01-31 03:26:05 | 8539fed3c29db6318eb2b7ad7b58936b32777a4c

Add unit tests for AclMatcher

Also fixes a few bugs.
Fixes #2411. | 2020-01-24 11:52:34 | 668740fca477ee808ebcace17bf7ad3faf8bb65d

Merge pull request #2398 from shadowsocks/patch-2391

Plugin 1.3.2 | 2020-01-11 11:06:27 | 00411646acaa840952a7b80f2654dc9d96716b4a

Ensure #2391 is fixed | 2020-01-09 09:34:29 | a9ef6bc98707a33ed08837a7cabfcdab99abbe0c

Fix some bugs | 2019-12-31 08:41:41 | 091ae7340fb44c7a1560d42cf81b99cfa0510b48

Support matching IPv6 in LocalDnsServer

This fixes confusions once and for all in like fa3d4e78b8104c98812802f9aa8ba163fe59f0d7.

Also updates China IP address blocks. | 2019-12-13 14:29:55 | 7ea25c7ce446c3634705050d73fae14e78446fee

Update dependencies and refine style (#2308)

* Update dependencies

* Fix styling issues

* Some more fixes

Fixes #2306. | 2019-09-19 00:54:45 | 11c09efa4f3931889c66be116cbd88958d40b308

Various fixes for #2263 | 2019-07-20 04:14:17 | f5084e0442c564bb511dc1d9341deaf1cf451eff

Revert "Late init WorkManager"

This reverts commit 33e5d4ddc148eecd440f8839d09cce7853065e78.

This fixes crashes caused by receivers. | 2019-06-23 09:43:58 | 3630514a2f1b491487611adf66abb0ccbbdc6bad

Introduce faster native plugin initialization

Please read doc for METADATA_KEY_EXECUTABLE_PATH for more details.
Basically, we get around application launching limitations from Huawei (among others) by reading metadata and therefore prevent launching the application altogether.
This should hopefully fix #1091, #1106. (requires plugin app support)

This commit also refines error reporting in PluginManager. | 2019-06-19 17:43:22 | 1247c68327f5218321b1533a261cd62dd8f17d07

Make service notification more compact

This also fixes styling issue on Android Q beta 1 thru 4. | 2019-06-19 14:08:36 | 554a9b1b5df3a988db1dc2e050989021ffc90a5c

Merge pull request #2211 from shadowsocks/fix-2209

Fix #2209 | 2019-05-21 12:49:06 | 0bd0207bcf153dbb6f4d219e3238bb14cc72d4e0

Merge pull request #2181 from CzBiX/patch-1

Update faq.md | 2019-03-29 22:46:33 | fbb82c8a459d7e076309e6a162b2ba2061945172

Do not complete local resolving in IO dispatchers on Q | 2019-03-26 20:05:51 | ebda36ee194998a264914e81995e96f81e435886

Update gradle to 3.4 and fix lint | 2019-03-15 14:40:16 | 789d34ff9c2c7cf9927558337e8d63ec02727677

Ignore general exceptions from selector.select

Bug on Android 6-: https://bugs.openjdk.java.net/browse/JDK-4729342 | 2019-03-03 03:48:18 | 41aea5e3b472289b0bb674db640d251ba3e661ae

Update bug_report.md | 2019-02-24 10:28:59 | a7a16fb91a0bb5dacf00c3cdbdcc0187ad7dc1ea

Revert bad update

Remember kids, refactoring = introduced new bugs. | 2019-02-21 18:27:56 | 0345605628e0c8ae4fda06c65473ec7ad619cf7e

Handle race condition in disconnect vs callback

Our unregisterCallback is an oneway callback, meaning race conditions might happen. A quick fix is to check for callback. | 2019-02-21 16:42:07 | f10f11d4d9b5dec7d794e65a321d7d616ea93f8c

Dispatch kill executables to background | 2019-02-08 09:22:37 | 0d5834eb72097a71327c17e738600d7bcd047e4f

Finally we fix cancelling | 2019-01-31 07:02:23 | 1def9e69cee528e91f51a3fdb48d6b3dff81c455

Fix another casting bug | 2019-01-21 07:56:16 | c0ad584122d098f9d969c3a3d395a709d5a4abac

Update bug_report.md | 2018-12-29 13:22:50 | 99fd4f5f9f439383a356b1c5618d8ad6aab3c763

Merge pull request #2020 from shadowsocks/fix-bab

Fix bottom app bar | 2018-12-10 01:57:24 | 99f7283523007632c9cef47d8ec80bc023f45e62

Merge branch 'master' into fix-bab | 2018-12-07 09:35:06 | cc7bc5bf8b9281738b655d91812a1fa2948d7a16

Merge pull request #2019 from shadowsocks/revert-1990-fix-bab

Revert "Fix bottom app bar" | 2018-12-07 06:43:24 | b7827d3ca3432abbc7bcbc455887d12bede05ac8

Merge pull request #1990 from Mygod/fix-bab

Fix bottom app bar | 2018-12-07 05:07:35 | e13a4cc809136f3806252111d150b81ab4170ea7

Merge branch 'master' into fix-bab | 2018-12-07 05:07:23 | 343ecac838b7ce55b179e9bda115f0b2904ce84b

Merge pull request #1982 from xmh19936688/patch-1

don't set GOROOT if already exist | 2018-10-29 01:03:52 | d3fd0945b128eb2ae39c26fc99cfe4d0cf81730a

Revert "Remove unnecessary bypassHostnames in Acl" and fix inconsistencies of ACL file handling

This reverts commit e5cd145b2499ccf90dfd24f8d52b12ab45c4c332. Fixes #1895. | 2018-07-30 16:07:22 | fa240eaee407ad14b1587c60352f15179345d5aa

Remove obsolete fix

This bug has been fixed in 24.0.0. https://stackoverflow.com/questions/15207305/getting-the-error-java-lang-illegalstateexception-activity-has-been-destroyed#comment64093540_15656428 | 2018-07-12 09:05:33 | 1a890b12fb5dc29d1032bc0b3f620c36dae685db

Bugfix | 2018-06-11 02:47:25 | 51e57528dc7567a3f8c9f3198d2ee495c5b75672

support night theme (#1750)

* kotlin version materialdrawer

* support dark theme

* add night mode settings

* revert materialdrawer

* revert translucent style

* update dark theme color

* add night mode changed listener

* fix dependency issue

* Fix issues with bottom sheet

* Use support lib default value

* fix stat title color

* change default nightmode value

* update background color

* add night about page

* clean style

* Fix colors in selection mode in custom rules

* Fix weird AboutFragment issues

* Misc refinements

* Fix cucstom tabs colors

* Fix inconsistent color in background_profile

* Add EXTRA_NIGHT_MODE to plugin interface

* Revert changes to plugin/build.gradle

* update toolbar popupTheme | 2018-06-01 12:35:56 | e2364b14e8170813f6b8bfe7f382d43c18c9264f

Name threads for better debugging experience

Also removes an unnecessary thread. | 2018-03-30 08:04:42 | b634ef0d82525a91578c3a981cb12817814460f6

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 0af450008b021592d3a1241891f593ddfbd57b15

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 3a8f863bd1f0deed081de082a674020368f30319

Enable multi-dex for debug builds

This is not a big deal thanks to min API = 21 and instant run already uses multi-dex anyways. | 2018-02-11 11:07:24 | 62375a576cdcd168302f04c7990ae3f15224c99c

Merge pull request #1593 from chon219/fix-windows-script

fixed windows build script for overture | 2018-01-22 04:58:36 | 2ef042d56b8043f2ac8b0069a4cd7c41cd1541d6

fixed windows build script for overture | 2018-01-21 10:57:20 | 0fa97f064fad5de32b24ebffd161668f13b588dd

Fix debug builds | 2018-01-19 07:10:12 | 168c0588a6ccc31be5e6a06930c655593bcc02c5

Add animation for bottom bar during Snackbar transitions

Fix #1036 the one-year-old issue.

There are still some subtle blackness during the exit animation. Unfortunately this is something I am not able to fix as I don't and probably won't ever have enough knowledge about Android's drawing passes. Anyway this still looks much better than before. | 2017-12-29 12:58:02 | 0335d67dba2f7367c537cbf5a81ecc37088ce1d2

Add more tests, fix lint errors and add check to travis | 2017-12-14 22:54:44 | 30b56c97eac761d5d80c7bc7d852d46015427cc9

Fix LocalSocketListener on debug builds

I have no idea what I'm doing. Somebody please explain. | 2017-12-07 00:57:28 | c013284b1b8d393b0e00cc750897f4fd8c6805a9

Use Gericop's preference library (#1471)

* New SimpleMenuPreference;
* More Oreo-like preference style;
* I'm tired of fixing all those bugs;
* Remove NumberPickerPreference which nobody likes. | 2017-12-01 04:10:47 | 8c33345a1feb6c1cb4cd22f912bb002c28c22a9f

Add a workaround for a support library bug | 2017-11-18 21:04:26 | 3cb6bb73b3a8137af3e1cf4f3251cb83754e5700

Lift default notification priority for VPN service

Priority has been lifted from IMPORTANCE_MIN to IMPORTANCE_LOW. This change only impacts Android 8.0 and higher.

Fixes #1431. Also fixes https://github.com/shadowsocks/shadowsocks-android/issues/1037#issuecomment-338367917. | 2017-11-15 07:50:06 | c6bb913ba248051e0b9fdd3ead5f37ed4bc4f8ec

fix fragment called onstart twice on click back

Removed irrelevant changes. | 2017-11-11 03:46:42 | 86ebbd0db5c281de4d18980521a3fb3d1251ed47

Fix the magic bug in sbt

https://stackoverflow.com/a/24860931/2245107 | 2017-10-25 23:57:44 | e79a93545b583d28ac4f9f381decda5e24b09bb0

Remove support for external scanners

I decided to remove this feature because I saw that Google Authenticator is doing the same: https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2

Also fix #1407. | 2017-10-21 03:59:24 | 9075d079d25fc570503d03261607b84ed0542c6f

Revert dm7 scanner back to 1.9.3

The latest 1.9.5 version seems to have bugs on Android O. | 2017-07-31 02:19:06 | a3f57d2557fcdf3f1a6dc76c949a268be5968e96

Replace SharedPreferences with SQLite

Other changes included:

* Fix a bug where dirty flag is not set correctly when changing per-app
  proxy settings;
* Old auto connect settings in SharedPreference is now ignored. | 2017-07-14 17:05:04 | 27fc27346cf85a1b40300efdd4402954a2609343

Remove debug info | 2017-05-05 23:30:44 | 73462b08af3978499ef798442f4c4f391a7c28d7

Add a known issue for Huawei's buggy ROM | 2017-02-02 09:22:27 | 4996d4fc5273439af10092922f52a64ee26ea6cb

Some bugfixes for new UI | 2017-01-13 18:31:01 | d5be325ab5815dc3eb35f8beaf61a9e391b32a8d

Bugfix for layout gravity | 2017-01-05 12:51:51 | af9e8c786db1a809ccfb86ae37249afbd9f3a2da

Fix a bug in serializing profile | 2016-12-24 15:25:23 | 5898d2917787c010d77ac0d672a118f28a6318c7

Layout bugfixes | 2016-12-23 17:40:55 | 25b6a307de93b762a5e3256a8c954d00e571d104

Fix a bug of profile serializing | 2016-12-20 10:15:09 | 7564ba5184dd6fe3c2a6e844a6cf465a0f915864

Boring bugfix don't look | 2016-10-12 06:56:50 | b5f655beb5796aea8a7ab2ac46141f181b835cf2

Fix Chinese locales once and for all (up to Nougat)

Seriously fix #927. From now on it will work even in Hong Kong (`/^zh-Han[st]-HK$/`) where for some reason people use Simplified Chinese and Traditional Chinese at the same time. | 2016-10-08 16:08:06 | 396d31a0a75beae6d3bd46dba22e7ce39292d9b2

Use styling to fix #910 | 2016-10-05 15:12:25 | 1d6a0b0f2b8c5762fab5496ce3b97c31ab7e315a

Don't suppress log in debug builds | 2016-09-22 13:18:02 | dd63bda2cdde0c988557a0c74b94397567d60b4e

Remove all the extravagant styles

These styles are either introduced by @AnyOfYou, or exist because of a bug in Android support library. Anyway they can be removed now. | 2016-08-19 11:49:43 | 25cfb1623a5fb9f6885c60bc9ca2f61bb91473a6

Fix SecurityException on Asus Fonepads

This is a bug of their ROMs but the documentation says:

> Must be required by a VpnService, to ensure that only the system can bind to it.
>
> Protection level: signature
>
> Constant Value: "android.permission.BIND_VPN_SERVICE"

And we have `android:exported="false"` set, so I think it's safe to remove this permission restriction. | 2016-08-09 02:45:02 | f7d422da2b5907f70fdef648325a041ca3393e71

Fix a bug in SummaryEditTextPreference | 2016-08-08 10:46:09 | 72305c5f60962f55d5d4d11981645571425d5ba8

Bugfix for previous commit | 2016-07-18 07:27:55 | b5ce7883537bb3e308b22ba23125654c106e6218

Revert "Refine #530 again and again" and probably fix #530

This reverts commit b833cb6267a56224dc9cc17093153bc8dc19d88a. | 2016-07-12 07:56:32 | c92d66d9f38ea0468f46dfa020d495537584423c

Bugfix for DropDownPreference | 2016-07-11 12:43:50 | 44625ae5b03db07b390bbb39fadfb35aa0a4c50f

Bugfix for NAT mode | 2016-07-11 11:51:47 | 159e1dff789401c66daf6c939261bbe9179cc09d

Refine #530 again

Have. To. Do. More. Refinements.

Here's what happened in the buggy versions: (I think)

* `BootReceiver` starts which invokes `Utils.startSsService` which starts `ShadowsocksRunnerService`;
* `ShadowsocksRunnerService` binds to `BaseService`;
* 1s after it's connected, it invokes `bgService.use` which returns immediately after pushing `use` in the queue since it's an oneway method;
* Then `stopSelf` => `detachService`, `BaseService` now have nothing bound to it and not started either (neither foreground nor background), so the system can destroy it any time; (at this point, `BaseService.use` isn't invoked yet)
* `com.github.shadowsocks` process then probably exits since booting is a resource-heavy task, anyway it doesn't matter;
* Some time later `com.github.shadowsocks:bg` resumes running, and `BaseService` is stopped and destroyed. Now the system is no longer aware of this `BaseService` instance but it isn't garbage collected yet;
* `use` is finally invoked;
* `startService` is invoked in `startRunner` and the destroyed background service starts running; (bug of Android?)
* `startForeground` is invoked in `ShadowsocksNotification` but the system probably refused it since the service itself is already destroyed;
* When the main activity UI is brought up and requests binding, `com.github.shadowsocks:bg` which is unaware of the existing instance of `BaseService` creates another `BaseService` and thus everything gets messed up.

This commit fixes this by invoking `getState` (which isn't an oneway method) immediately after `use` so that `ShadowsocksRunnerService` will wait for `BaseService` to start itself before destroying itself and its connection to `BaseService`. And thus its return value is not used. | 2016-07-11 11:22:54 | 84ac2b06fae97318594a6884d2fcddc38dcfe7d8

Bugfix for NumberPickerPreference | 2016-07-11 09:51:13 | dcf190c1f55d9152284136a71eb144ffa5237f81

Fix the bug where UI is not updated after importing | 2016-07-04 02:38:49 | 432ab6cc7abb98af97b6c7e890b5d96dad28cd8d

Revert "Roll back to 23.2.0 support libraries, fix #737"

This reverts commit 90e3bb312f7f860e90813c710cf4ddb077963dc3. | 2016-07-01 02:13:30 | 7e082b3e6d58096d74f63125ced396ec9d0c7489

Roll back to 23.2.0 support libraries, fix #737 | 2016-07-01 01:51:22 | 90e3bb312f7f860e90813c710cf4ddb077963dc3

Fix DeathRecipient leaking bug | 2016-05-24 03:42:12 | c878d4daa6410ab240d9de4781192c227611d94c

Quick settings tile for N preview (draft)

Addresses #671 but has NOT fixed it yet. | 2016-05-05 13:41:44 | 5966c9d8744c3816ff8d10393a0dec30bbb34bac

UI fixes

* Refine exceptions handling when parsing per-app config string

* Remove redundant profiles Preference

* Move Network Traffic to title bar

* Add ripple to title text

* Animate using animateLayoutChanges

* Hide connection test in NAT mode

* Refine UI.

* Change notification action button icon for hidpi device

* Fix FAB ripple

* Fix usability problem

* Fix changes not commited when snackbar being swiped

* Show import/export as action

* Drop unused drawables

* Move TaskerSettings

* Fix action icons

* Prevent switching to an invalid profile

* Fix line wrap when screen width is small | 2016-04-04 20:41:31 | 7d9686b5b57cbf4f153052591317bbebb99ef2ba

ParserActivity bug fixes. | 2016-03-16 16:25:13 | dd4fad1a4135f98b58d885da70652b929878ed85

Merge pull request #609 from AnyOfYou/master

Fix parser bug, add share profile by NFC. | 2016-03-16 05:46:20 | e99a0eaafca6c4001192c7cf4713902842ddc94e

Fix parser bug | 2016-03-15 17:15:17 | f792c8ebfbfd38ed198b1ac3c13c779f2be2386c

Oops fix a bug | 2016-03-11 14:53:18 | 0f2ae6521bff6b1fdc39d98c28f32437c9c1f30c

Crash recovery for NAT mode

Bugfix: when NAT process is killed, Internet access is gone. Reproduce with:

    adb shell killall com.github.shadowsocks:nat

One circumstance it cannot recover from is when updating to a new version, where both processes are killed at the same time. But a reset will be executed when the new version is launched. | 2016-03-11 12:39:01 | 8657ef87f47050e0203b49218f02e26d1fd0c11e

Workaround for #2361

Related bug: https://issuetracker.google.com/issues/149636790 | 2020-02-16 23:14:39 | cc840c9fddb3f4f6677005de18f1fcb387b84064

Revert the debug flag | 2020-01-31 03:26:05 | 8539fed3c29db6318eb2b7ad7b58936b32777a4c

Add unit tests for AclMatcher

Also fixes a few bugs.
Fixes #2411. | 2020-01-24 11:52:34 | 668740fca477ee808ebcace17bf7ad3faf8bb65d

Merge pull request #2398 from shadowsocks/patch-2391

Plugin 1.3.2 | 2020-01-11 11:06:27 | 00411646acaa840952a7b80f2654dc9d96716b4a

Ensure #2391 is fixed | 2020-01-09 09:34:29 | a9ef6bc98707a33ed08837a7cabfcdab99abbe0c

Fix some bugs | 2019-12-31 08:41:41 | 091ae7340fb44c7a1560d42cf81b99cfa0510b48

Support matching IPv6 in LocalDnsServer

This fixes confusions once and for all in like fa3d4e78b8104c98812802f9aa8ba163fe59f0d7.

Also updates China IP address blocks. | 2019-12-13 14:29:55 | 7ea25c7ce446c3634705050d73fae14e78446fee

Update dependencies and refine style (#2308)

* Update dependencies

* Fix styling issues

* Some more fixes

Fixes #2306. | 2019-09-19 00:54:45 | 11c09efa4f3931889c66be116cbd88958d40b308

Various fixes for #2263 | 2019-07-20 04:14:17 | f5084e0442c564bb511dc1d9341deaf1cf451eff

Revert "Late init WorkManager"

This reverts commit 33e5d4ddc148eecd440f8839d09cce7853065e78.

This fixes crashes caused by receivers. | 2019-06-23 09:43:58 | 3630514a2f1b491487611adf66abb0ccbbdc6bad

Introduce faster native plugin initialization

Please read doc for METADATA_KEY_EXECUTABLE_PATH for more details.
Basically, we get around application launching limitations from Huawei (among others) by reading metadata and therefore prevent launching the application altogether.
This should hopefully fix #1091, #1106. (requires plugin app support)

This commit also refines error reporting in PluginManager. | 2019-06-19 17:43:22 | 1247c68327f5218321b1533a261cd62dd8f17d07

Make service notification more compact

This also fixes styling issue on Android Q beta 1 thru 4. | 2019-06-19 14:08:36 | 554a9b1b5df3a988db1dc2e050989021ffc90a5c

Merge pull request #2211 from shadowsocks/fix-2209

Fix #2209 | 2019-05-21 12:49:06 | 0bd0207bcf153dbb6f4d219e3238bb14cc72d4e0

Merge pull request #2181 from CzBiX/patch-1

Update faq.md | 2019-03-29 22:46:33 | fbb82c8a459d7e076309e6a162b2ba2061945172

Do not complete local resolving in IO dispatchers on Q | 2019-03-26 20:05:51 | ebda36ee194998a264914e81995e96f81e435886

Update gradle to 3.4 and fix lint | 2019-03-15 14:40:16 | 789d34ff9c2c7cf9927558337e8d63ec02727677

Ignore general exceptions from selector.select

Bug on Android 6-: https://bugs.openjdk.java.net/browse/JDK-4729342 | 2019-03-03 03:48:18 | 41aea5e3b472289b0bb674db640d251ba3e661ae

Update bug_report.md | 2019-02-24 10:28:59 | a7a16fb91a0bb5dacf00c3cdbdcc0187ad7dc1ea

Revert bad update

Remember kids, refactoring = introduced new bugs. | 2019-02-21 18:27:56 | 0345605628e0c8ae4fda06c65473ec7ad619cf7e

Handle race condition in disconnect vs callback

Our unregisterCallback is an oneway callback, meaning race conditions might happen. A quick fix is to check for callback. | 2019-02-21 16:42:07 | f10f11d4d9b5dec7d794e65a321d7d616ea93f8c

Dispatch kill executables to background | 2019-02-08 09:22:37 | 0d5834eb72097a71327c17e738600d7bcd047e4f

Finally we fix cancelling | 2019-01-31 07:02:23 | 1def9e69cee528e91f51a3fdb48d6b3dff81c455

Fix another casting bug | 2019-01-21 07:56:16 | c0ad584122d098f9d969c3a3d395a709d5a4abac

Update bug_report.md | 2018-12-29 13:22:50 | 99fd4f5f9f439383a356b1c5618d8ad6aab3c763

Merge pull request #2020 from shadowsocks/fix-bab

Fix bottom app bar | 2018-12-10 01:57:24 | 99f7283523007632c9cef47d8ec80bc023f45e62

Merge branch 'master' into fix-bab | 2018-12-07 09:35:06 | cc7bc5bf8b9281738b655d91812a1fa2948d7a16

Merge pull request #2019 from shadowsocks/revert-1990-fix-bab

Revert "Fix bottom app bar" | 2018-12-07 06:43:24 | b7827d3ca3432abbc7bcbc455887d12bede05ac8

Merge pull request #1990 from Mygod/fix-bab

Fix bottom app bar | 2018-12-07 05:07:35 | e13a4cc809136f3806252111d150b81ab4170ea7

Merge branch 'master' into fix-bab | 2018-12-07 05:07:23 | 343ecac838b7ce55b179e9bda115f0b2904ce84b

Merge pull request #1982 from xmh19936688/patch-1

don't set GOROOT if already exist | 2018-10-29 01:03:52 | d3fd0945b128eb2ae39c26fc99cfe4d0cf81730a

Revert "Remove unnecessary bypassHostnames in Acl" and fix inconsistencies of ACL file handling

This reverts commit e5cd145b2499ccf90dfd24f8d52b12ab45c4c332. Fixes #1895. | 2018-07-30 16:07:22 | fa240eaee407ad14b1587c60352f15179345d5aa

Remove obsolete fix

This bug has been fixed in 24.0.0. https://stackoverflow.com/questions/15207305/getting-the-error-java-lang-illegalstateexception-activity-has-been-destroyed#comment64093540_15656428 | 2018-07-12 09:05:33 | 1a890b12fb5dc29d1032bc0b3f620c36dae685db

Bugfix | 2018-06-11 02:47:25 | 51e57528dc7567a3f8c9f3198d2ee495c5b75672

support night theme (#1750)

* kotlin version materialdrawer

* support dark theme

* add night mode settings

* revert materialdrawer

* revert translucent style

* update dark theme color

* add night mode changed listener

* fix dependency issue

* Fix issues with bottom sheet

* Use support lib default value

* fix stat title color

* change default nightmode value

* update background color

* add night about page

* clean style

* Fix colors in selection mode in custom rules

* Fix weird AboutFragment issues

* Misc refinements

* Fix cucstom tabs colors

* Fix inconsistent color in background_profile

* Add EXTRA_NIGHT_MODE to plugin interface

* Revert changes to plugin/build.gradle

* update toolbar popupTheme | 2018-06-01 12:35:56 | e2364b14e8170813f6b8bfe7f382d43c18c9264f

Name threads for better debugging experience

Also removes an unnecessary thread. | 2018-03-30 08:04:42 | b634ef0d82525a91578c3a981cb12817814460f6

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 0af450008b021592d3a1241891f593ddfbd57b15

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 3a8f863bd1f0deed081de082a674020368f30319

Enable multi-dex for debug builds

This is not a big deal thanks to min API = 21 and instant run already uses multi-dex anyways. | 2018-02-11 11:07:24 | 62375a576cdcd168302f04c7990ae3f15224c99c

Merge pull request #1593 from chon219/fix-windows-script

fixed windows build script for overture | 2018-01-22 04:58:36 | 2ef042d56b8043f2ac8b0069a4cd7c41cd1541d6

fixed windows build script for overture | 2018-01-21 10:57:20 | 0fa97f064fad5de32b24ebffd161668f13b588dd

Fix debug builds | 2018-01-19 07:10:12 | 168c0588a6ccc31be5e6a06930c655593bcc02c5

Add animation for bottom bar during Snackbar transitions

Fix #1036 the one-year-old issue.

There are still some subtle blackness during the exit animation. Unfortunately this is something I am not able to fix as I don't and probably won't ever have enough knowledge about Android's drawing passes. Anyway this still looks much better than before. | 2017-12-29 12:58:02 | 0335d67dba2f7367c537cbf5a81ecc37088ce1d2

Add more tests, fix lint errors and add check to travis | 2017-12-14 22:54:44 | 30b56c97eac761d5d80c7bc7d852d46015427cc9

Fix LocalSocketListener on debug builds

I have no idea what I'm doing. Somebody please explain. | 2017-12-07 00:57:28 | c013284b1b8d393b0e00cc750897f4fd8c6805a9

Use Gericop's preference library (#1471)

* New SimpleMenuPreference;
* More Oreo-like preference style;
* I'm tired of fixing all those bugs;
* Remove NumberPickerPreference which nobody likes. | 2017-12-01 04:10:47 | 8c33345a1feb6c1cb4cd22f912bb002c28c22a9f

Add a workaround for a support library bug | 2017-11-18 21:04:26 | 3cb6bb73b3a8137af3e1cf4f3251cb83754e5700

Lift default notification priority for VPN service

Priority has been lifted from IMPORTANCE_MIN to IMPORTANCE_LOW. This change only impacts Android 8.0 and higher.

Fixes #1431. Also fixes https://github.com/shadowsocks/shadowsocks-android/issues/1037#issuecomment-338367917. | 2017-11-15 07:50:06 | c6bb913ba248051e0b9fdd3ead5f37ed4bc4f8ec

fix fragment called onstart twice on click back

Removed irrelevant changes. | 2017-11-11 03:46:42 | 86ebbd0db5c281de4d18980521a3fb3d1251ed47

Fix the magic bug in sbt

https://stackoverflow.com/a/24860931/2245107 | 2017-10-25 23:57:44 | e79a93545b583d28ac4f9f381decda5e24b09bb0

Remove support for external scanners

I decided to remove this feature because I saw that Google Authenticator is doing the same: https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2

Also fix #1407. | 2017-10-21 03:59:24 | 9075d079d25fc570503d03261607b84ed0542c6f

Revert dm7 scanner back to 1.9.3

The latest 1.9.5 version seems to have bugs on Android O. | 2017-07-31 02:19:06 | a3f57d2557fcdf3f1a6dc76c949a268be5968e96

Replace SharedPreferences with SQLite

Other changes included:

* Fix a bug where dirty flag is not set correctly when changing per-app
  proxy settings;
* Old auto connect settings in SharedPreference is now ignored. | 2017-07-14 17:05:04 | 27fc27346cf85a1b40300efdd4402954a2609343

Remove debug info | 2017-05-05 23:30:44 | 73462b08af3978499ef798442f4c4f391a7c28d7

Add a known issue for Huawei's buggy ROM | 2017-02-02 09:22:27 | 4996d4fc5273439af10092922f52a64ee26ea6cb

Some bugfixes for new UI | 2017-01-13 18:31:01 | d5be325ab5815dc3eb35f8beaf61a9e391b32a8d

Bugfix for layout gravity | 2017-01-05 12:51:51 | af9e8c786db1a809ccfb86ae37249afbd9f3a2da

Fix a bug in serializing profile | 2016-12-24 15:25:23 | 5898d2917787c010d77ac0d672a118f28a6318c7

Layout bugfixes | 2016-12-23 17:40:55 | 25b6a307de93b762a5e3256a8c954d00e571d104

Fix a bug of profile serializing | 2016-12-20 10:15:09 | 7564ba5184dd6fe3c2a6e844a6cf465a0f915864

Boring bugfix don't look | 2016-10-12 06:56:50 | b5f655beb5796aea8a7ab2ac46141f181b835cf2

Fix Chinese locales once and for all (up to Nougat)

Seriously fix #927. From now on it will work even in Hong Kong (`/^zh-Han[st]-HK$/`) where for some reason people use Simplified Chinese and Traditional Chinese at the same time. | 2016-10-08 16:08:06 | 396d31a0a75beae6d3bd46dba22e7ce39292d9b2

Use styling to fix #910 | 2016-10-05 15:12:25 | 1d6a0b0f2b8c5762fab5496ce3b97c31ab7e315a

Don't suppress log in debug builds | 2016-09-22 13:18:02 | dd63bda2cdde0c988557a0c74b94397567d60b4e

Remove all the extravagant styles

These styles are either introduced by @AnyOfYou, or exist because of a bug in Android support library. Anyway they can be removed now. | 2016-08-19 11:49:43 | 25cfb1623a5fb9f6885c60bc9ca2f61bb91473a6

Fix SecurityException on Asus Fonepads

This is a bug of their ROMs but the documentation says:

> Must be required by a VpnService, to ensure that only the system can bind to it.
>
> Protection level: signature
>
> Constant Value: "android.permission.BIND_VPN_SERVICE"

And we have `android:exported="false"` set, so I think it's safe to remove this permission restriction. | 2016-08-09 02:45:02 | f7d422da2b5907f70fdef648325a041ca3393e71

Fix a bug in SummaryEditTextPreference | 2016-08-08 10:46:09 | 72305c5f60962f55d5d4d11981645571425d5ba8

Bugfix for previous commit | 2016-07-18 07:27:55 | b5ce7883537bb3e308b22ba23125654c106e6218

Revert "Refine #530 again and again" and probably fix #530

This reverts commit b833cb6267a56224dc9cc17093153bc8dc19d88a. | 2016-07-12 07:56:32 | c92d66d9f38ea0468f46dfa020d495537584423c

Bugfix for DropDownPreference | 2016-07-11 12:43:50 | 44625ae5b03db07b390bbb39fadfb35aa0a4c50f

Bugfix for NAT mode | 2016-07-11 11:51:47 | 159e1dff789401c66daf6c939261bbe9179cc09d

Refine #530 again

Have. To. Do. More. Refinements.

Here's what happened in the buggy versions: (I think)

* `BootReceiver` starts which invokes `Utils.startSsService` which starts `ShadowsocksRunnerService`;
* `ShadowsocksRunnerService` binds to `BaseService`;
* 1s after it's connected, it invokes `bgService.use` which returns immediately after pushing `use` in the queue since it's an oneway method;
* Then `stopSelf` => `detachService`, `BaseService` now have nothing bound to it and not started either (neither foreground nor background), so the system can destroy it any time; (at this point, `BaseService.use` isn't invoked yet)
* `com.github.shadowsocks` process then probably exits since booting is a resource-heavy task, anyway it doesn't matter;
* Some time later `com.github.shadowsocks:bg` resumes running, and `BaseService` is stopped and destroyed. Now the system is no longer aware of this `BaseService` instance but it isn't garbage collected yet;
* `use` is finally invoked;
* `startService` is invoked in `startRunner` and the destroyed background service starts running; (bug of Android?)
* `startForeground` is invoked in `ShadowsocksNotification` but the system probably refused it since the service itself is already destroyed;
* When the main activity UI is brought up and requests binding, `com.github.shadowsocks:bg` which is unaware of the existing instance of `BaseService` creates another `BaseService` and thus everything gets messed up.

This commit fixes this by invoking `getState` (which isn't an oneway method) immediately after `use` so that `ShadowsocksRunnerService` will wait for `BaseService` to start itself before destroying itself and its connection to `BaseService`. And thus its return value is not used. | 2016-07-11 11:22:54 | 84ac2b06fae97318594a6884d2fcddc38dcfe7d8

Bugfix for NumberPickerPreference | 2016-07-11 09:51:13 | dcf190c1f55d9152284136a71eb144ffa5237f81

Fix the bug where UI is not updated after importing | 2016-07-04 02:38:49 | 432ab6cc7abb98af97b6c7e890b5d96dad28cd8d

Revert "Roll back to 23.2.0 support libraries, fix #737"

This reverts commit 90e3bb312f7f860e90813c710cf4ddb077963dc3. | 2016-07-01 02:13:30 | 7e082b3e6d58096d74f63125ced396ec9d0c7489

Roll back to 23.2.0 support libraries, fix #737 | 2016-07-01 01:51:22 | 90e3bb312f7f860e90813c710cf4ddb077963dc3

Fix DeathRecipient leaking bug | 2016-05-24 03:42:12 | c878d4daa6410ab240d9de4781192c227611d94c

Quick settings tile for N preview (draft)

Addresses #671 but has NOT fixed it yet. | 2016-05-05 13:41:44 | 5966c9d8744c3816ff8d10393a0dec30bbb34bac

UI fixes

* Refine exceptions handling when parsing per-app config string

* Remove redundant profiles Preference

* Move Network Traffic to title bar

* Add ripple to title text

* Animate using animateLayoutChanges

* Hide connection test in NAT mode

* Refine UI.

* Change notification action button icon for hidpi device

* Fix FAB ripple

* Fix usability problem

* Fix changes not commited when snackbar being swiped

* Show import/export as action

* Drop unused drawables

* Move TaskerSettings

* Fix action icons

* Prevent switching to an invalid profile

* Fix line wrap when screen width is small | 2016-04-04 20:41:31 | 7d9686b5b57cbf4f153052591317bbebb99ef2ba

ParserActivity bug fixes. | 2016-03-16 16:25:13 | dd4fad1a4135f98b58d885da70652b929878ed85

Merge pull request #609 from AnyOfYou/master

Fix parser bug, add share profile by NFC. | 2016-03-16 05:46:20 | e99a0eaafca6c4001192c7cf4713902842ddc94e

Fix parser bug | 2016-03-15 17:15:17 | f792c8ebfbfd38ed198b1ac3c13c779f2be2386c

Oops fix a bug | 2016-03-11 14:53:18 | 0f2ae6521bff6b1fdc39d98c28f32437c9c1f30c

Crash recovery for NAT mode

Bugfix: when NAT process is killed, Internet access is gone. Reproduce with:

    adb shell killall com.github.shadowsocks:nat

One circumstance it cannot recover from is when updating to a new version, where both processes are killed at the same time. But a reset will be executed when the new version is launched. | 2016-03-11 12:39:01 | 8657ef87f47050e0203b49218f02e26d1fd0c11e

Merge pull request #2020 from shadowsocks/fix-bab

Fix bottom app bar | 2018-12-10 01:57:24 | 99f7283523007632c9cef47d8ec80bc023f45e62

Merge branch 'master' into fix-bab | 2018-12-07 09:35:06 | cc7bc5bf8b9281738b655d91812a1fa2948d7a16

Merge pull request #2019 from shadowsocks/revert-1990-fix-bab

Revert "Fix bottom app bar" | 2018-12-07 06:43:24 | b7827d3ca3432abbc7bcbc455887d12bede05ac8

Merge pull request #1990 from Mygod/fix-bab

Fix bottom app bar | 2018-12-07 05:07:35 | e13a4cc809136f3806252111d150b81ab4170ea7

Merge branch 'master' into fix-bab | 2018-12-07 05:07:23 | 343ecac838b7ce55b179e9bda115f0b2904ce84b

Merge pull request #1982 from xmh19936688/patch-1

don't set GOROOT if already exist | 2018-10-29 01:03:52 | d3fd0945b128eb2ae39c26fc99cfe4d0cf81730a

Revert "Remove unnecessary bypassHostnames in Acl" and fix inconsistencies of ACL file handling

This reverts commit e5cd145b2499ccf90dfd24f8d52b12ab45c4c332. Fixes #1895. | 2018-07-30 16:07:22 | fa240eaee407ad14b1587c60352f15179345d5aa

Remove obsolete fix

This bug has been fixed in 24.0.0. https://stackoverflow.com/questions/15207305/getting-the-error-java-lang-illegalstateexception-activity-has-been-destroyed#comment64093540_15656428 | 2018-07-12 09:05:33 | 1a890b12fb5dc29d1032bc0b3f620c36dae685db

Bugfix | 2018-06-11 02:47:25 | 51e57528dc7567a3f8c9f3198d2ee495c5b75672

support night theme (#1750)

* kotlin version materialdrawer

* support dark theme

* add night mode settings

* revert materialdrawer

* revert translucent style

* update dark theme color

* add night mode changed listener

* fix dependency issue

* Fix issues with bottom sheet

* Use support lib default value

* fix stat title color

* change default nightmode value

* update background color

* add night about page

* clean style

* Fix colors in selection mode in custom rules

* Fix weird AboutFragment issues

* Misc refinements

* Fix cucstom tabs colors

* Fix inconsistent color in background_profile

* Add EXTRA_NIGHT_MODE to plugin interface

* Revert changes to plugin/build.gradle

* update toolbar popupTheme | 2018-06-01 12:35:56 | e2364b14e8170813f6b8bfe7f382d43c18c9264f

Name threads for better debugging experience

Also removes an unnecessary thread. | 2018-03-30 08:04:42 | b634ef0d82525a91578c3a981cb12817814460f6

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 0af450008b021592d3a1241891f593ddfbd57b15

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 3a8f863bd1f0deed081de082a674020368f30319

Enable multi-dex for debug builds

This is not a big deal thanks to min API = 21 and instant run already uses multi-dex anyways. | 2018-02-11 11:07:24 | 62375a576cdcd168302f04c7990ae3f15224c99c

Merge pull request #1593 from chon219/fix-windows-script

fixed windows build script for overture | 2018-01-22 04:58:36 | 2ef042d56b8043f2ac8b0069a4cd7c41cd1541d6

fixed windows build script for overture | 2018-01-21 10:57:20 | 0fa97f064fad5de32b24ebffd161668f13b588dd

Fix debug builds | 2018-01-19 07:10:12 | 168c0588a6ccc31be5e6a06930c655593bcc02c5

Add animation for bottom bar during Snackbar transitions

Fix #1036 the one-year-old issue.

There are still some subtle blackness during the exit animation. Unfortunately this is something I am not able to fix as I don't and probably won't ever have enough knowledge about Android's drawing passes. Anyway this still looks much better than before. | 2017-12-29 12:58:02 | 0335d67dba2f7367c537cbf5a81ecc37088ce1d2

Add more tests, fix lint errors and add check to travis | 2017-12-14 22:54:44 | 30b56c97eac761d5d80c7bc7d852d46015427cc9

Fix LocalSocketListener on debug builds

I have no idea what I'm doing. Somebody please explain. | 2017-12-07 00:57:28 | c013284b1b8d393b0e00cc750897f4fd8c6805a9

Use Gericop's preference library (#1471)

* New SimpleMenuPreference;
* More Oreo-like preference style;
* I'm tired of fixing all those bugs;
* Remove NumberPickerPreference which nobody likes. | 2017-12-01 04:10:47 | 8c33345a1feb6c1cb4cd22f912bb002c28c22a9f

Add a workaround for a support library bug | 2017-11-18 21:04:26 | 3cb6bb73b3a8137af3e1cf4f3251cb83754e5700

Lift default notification priority for VPN service

Priority has been lifted from IMPORTANCE_MIN to IMPORTANCE_LOW. This change only impacts Android 8.0 and higher.

Fixes #1431. Also fixes https://github.com/shadowsocks/shadowsocks-android/issues/1037#issuecomment-338367917. | 2017-11-15 07:50:06 | c6bb913ba248051e0b9fdd3ead5f37ed4bc4f8ec

fix fragment called onstart twice on click back

Removed irrelevant changes. | 2017-11-11 03:46:42 | 86ebbd0db5c281de4d18980521a3fb3d1251ed47

Fix the magic bug in sbt

https://stackoverflow.com/a/24860931/2245107 | 2017-10-25 23:57:44 | e79a93545b583d28ac4f9f381decda5e24b09bb0

Remove support for external scanners

I decided to remove this feature because I saw that Google Authenticator is doing the same: https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2

Also fix #1407. | 2017-10-21 03:59:24 | 9075d079d25fc570503d03261607b84ed0542c6f

Revert dm7 scanner back to 1.9.3

The latest 1.9.5 version seems to have bugs on Android O. | 2017-07-31 02:19:06 | a3f57d2557fcdf3f1a6dc76c949a268be5968e96

Replace SharedPreferences with SQLite

Other changes included:

* Fix a bug where dirty flag is not set correctly when changing per-app
  proxy settings;
* Old auto connect settings in SharedPreference is now ignored. | 2017-07-14 17:05:04 | 27fc27346cf85a1b40300efdd4402954a2609343

Remove debug info | 2017-05-05 23:30:44 | 73462b08af3978499ef798442f4c4f391a7c28d7

Add a known issue for Huawei's buggy ROM | 2017-02-02 09:22:27 | 4996d4fc5273439af10092922f52a64ee26ea6cb

Some bugfixes for new UI | 2017-01-13 18:31:01 | d5be325ab5815dc3eb35f8beaf61a9e391b32a8d

Bugfix for layout gravity | 2017-01-05 12:51:51 | af9e8c786db1a809ccfb86ae37249afbd9f3a2da

Fix a bug in serializing profile | 2016-12-24 15:25:23 | 5898d2917787c010d77ac0d672a118f28a6318c7

Layout bugfixes | 2016-12-23 17:40:55 | 25b6a307de93b762a5e3256a8c954d00e571d104

Fix a bug of profile serializing | 2016-12-20 10:15:09 | 7564ba5184dd6fe3c2a6e844a6cf465a0f915864

Boring bugfix don't look | 2016-10-12 06:56:50 | b5f655beb5796aea8a7ab2ac46141f181b835cf2

Fix Chinese locales once and for all (up to Nougat)

Seriously fix #927. From now on it will work even in Hong Kong (`/^zh-Han[st]-HK$/`) where for some reason people use Simplified Chinese and Traditional Chinese at the same time. | 2016-10-08 16:08:06 | 396d31a0a75beae6d3bd46dba22e7ce39292d9b2

Use styling to fix #910 | 2016-10-05 15:12:25 | 1d6a0b0f2b8c5762fab5496ce3b97c31ab7e315a

Don't suppress log in debug builds | 2016-09-22 13:18:02 | dd63bda2cdde0c988557a0c74b94397567d60b4e

Remove all the extravagant styles

These styles are either introduced by @AnyOfYou, or exist because of a bug in Android support library. Anyway they can be removed now. | 2016-08-19 11:49:43 | 25cfb1623a5fb9f6885c60bc9ca2f61bb91473a6

Fix SecurityException on Asus Fonepads

This is a bug of their ROMs but the documentation says:

> Must be required by a VpnService, to ensure that only the system can bind to it.
>
> Protection level: signature
>
> Constant Value: "android.permission.BIND_VPN_SERVICE"

And we have `android:exported="false"` set, so I think it's safe to remove this permission restriction. | 2016-08-09 02:45:02 | f7d422da2b5907f70fdef648325a041ca3393e71

Fix a bug in SummaryEditTextPreference | 2016-08-08 10:46:09 | 72305c5f60962f55d5d4d11981645571425d5ba8

Bugfix for previous commit | 2016-07-18 07:27:55 | b5ce7883537bb3e308b22ba23125654c106e6218

Revert "Refine #530 again and again" and probably fix #530

This reverts commit b833cb6267a56224dc9cc17093153bc8dc19d88a. | 2016-07-12 07:56:32 | c92d66d9f38ea0468f46dfa020d495537584423c

Bugfix for DropDownPreference | 2016-07-11 12:43:50 | 44625ae5b03db07b390bbb39fadfb35aa0a4c50f

Bugfix for NAT mode | 2016-07-11 11:51:47 | 159e1dff789401c66daf6c939261bbe9179cc09d

Refine #530 again

Have. To. Do. More. Refinements.

Here's what happened in the buggy versions: (I think)

* `BootReceiver` starts which invokes `Utils.startSsService` which starts `ShadowsocksRunnerService`;
* `ShadowsocksRunnerService` binds to `BaseService`;
* 1s after it's connected, it invokes `bgService.use` which returns immediately after pushing `use` in the queue since it's an oneway method;
* Then `stopSelf` => `detachService`, `BaseService` now have nothing bound to it and not started either (neither foreground nor background), so the system can destroy it any time; (at this point, `BaseService.use` isn't invoked yet)
* `com.github.shadowsocks` process then probably exits since booting is a resource-heavy task, anyway it doesn't matter;
* Some time later `com.github.shadowsocks:bg` resumes running, and `BaseService` is stopped and destroyed. Now the system is no longer aware of this `BaseService` instance but it isn't garbage collected yet;
* `use` is finally invoked;
* `startService` is invoked in `startRunner` and the destroyed background service starts running; (bug of Android?)
* `startForeground` is invoked in `ShadowsocksNotification` but the system probably refused it since the service itself is already destroyed;
* When the main activity UI is brought up and requests binding, `com.github.shadowsocks:bg` which is unaware of the existing instance of `BaseService` creates another `BaseService` and thus everything gets messed up.

This commit fixes this by invoking `getState` (which isn't an oneway method) immediately after `use` so that `ShadowsocksRunnerService` will wait for `BaseService` to start itself before destroying itself and its connection to `BaseService`. And thus its return value is not used. | 2016-07-11 11:22:54 | 84ac2b06fae97318594a6884d2fcddc38dcfe7d8

Bugfix for NumberPickerPreference | 2016-07-11 09:51:13 | dcf190c1f55d9152284136a71eb144ffa5237f81

Fix the bug where UI is not updated after importing | 2016-07-04 02:38:49 | 432ab6cc7abb98af97b6c7e890b5d96dad28cd8d

Revert "Roll back to 23.2.0 support libraries, fix #737"

This reverts commit 90e3bb312f7f860e90813c710cf4ddb077963dc3. | 2016-07-01 02:13:30 | 7e082b3e6d58096d74f63125ced396ec9d0c7489

Roll back to 23.2.0 support libraries, fix #737 | 2016-07-01 01:51:22 | 90e3bb312f7f860e90813c710cf4ddb077963dc3

Fix DeathRecipient leaking bug | 2016-05-24 03:42:12 | c878d4daa6410ab240d9de4781192c227611d94c

Quick settings tile for N preview (draft)

Addresses #671 but has NOT fixed it yet. | 2016-05-05 13:41:44 | 5966c9d8744c3816ff8d10393a0dec30bbb34bac

UI fixes

* Refine exceptions handling when parsing per-app config string

* Remove redundant profiles Preference

* Move Network Traffic to title bar

* Add ripple to title text

* Animate using animateLayoutChanges

* Hide connection test in NAT mode

* Refine UI.

* Change notification action button icon for hidpi device

* Fix FAB ripple

* Fix usability problem

* Fix changes not commited when snackbar being swiped

* Show import/export as action

* Drop unused drawables

* Move TaskerSettings

* Fix action icons

* Prevent switching to an invalid profile

* Fix line wrap when screen width is small | 2016-04-04 20:41:31 | 7d9686b5b57cbf4f153052591317bbebb99ef2ba

ParserActivity bug fixes. | 2016-03-16 16:25:13 | dd4fad1a4135f98b58d885da70652b929878ed85

Merge pull request #609 from AnyOfYou/master

Fix parser bug, add share profile by NFC. | 2016-03-16 05:46:20 | e99a0eaafca6c4001192c7cf4713902842ddc94e

Fix parser bug | 2016-03-15 17:15:17 | f792c8ebfbfd38ed198b1ac3c13c779f2be2386c

Oops fix a bug | 2016-03-11 14:53:18 | 0f2ae6521bff6b1fdc39d98c28f32437c9c1f30c

Crash recovery for NAT mode

Bugfix: when NAT process is killed, Internet access is gone. Reproduce with:

    adb shell killall com.github.shadowsocks:nat

One circumstance it cannot recover from is when updating to a new version, where both processes are killed at the same time. But a reset will be executed when the new version is launched. | 2016-03-11 12:39:01 | 8657ef87f47050e0203b49218f02e26d1fd0c11e

Workaround for #2361

Related bug: https://issuetracker.google.com/issues/149636790 | 2020-02-16 23:14:39 | cc840c9fddb3f4f6677005de18f1fcb387b84064

Revert the debug flag | 2020-01-31 03:26:05 | 8539fed3c29db6318eb2b7ad7b58936b32777a4c

Add unit tests for AclMatcher

Also fixes a few bugs.
Fixes #2411. | 2020-01-24 11:52:34 | 668740fca477ee808ebcace17bf7ad3faf8bb65d

Merge pull request #2398 from shadowsocks/patch-2391

Plugin 1.3.2 | 2020-01-11 11:06:27 | 00411646acaa840952a7b80f2654dc9d96716b4a

Ensure #2391 is fixed | 2020-01-09 09:34:29 | a9ef6bc98707a33ed08837a7cabfcdab99abbe0c

Fix some bugs | 2019-12-31 08:41:41 | 091ae7340fb44c7a1560d42cf81b99cfa0510b48

Support matching IPv6 in LocalDnsServer

This fixes confusions once and for all in like fa3d4e78b8104c98812802f9aa8ba163fe59f0d7.

Also updates China IP address blocks. | 2019-12-13 14:29:55 | 7ea25c7ce446c3634705050d73fae14e78446fee

Update dependencies and refine style (#2308)

* Update dependencies

* Fix styling issues

* Some more fixes

Fixes #2306. | 2019-09-19 00:54:45 | 11c09efa4f3931889c66be116cbd88958d40b308

Various fixes for #2263 | 2019-07-20 04:14:17 | f5084e0442c564bb511dc1d9341deaf1cf451eff

Revert "Late init WorkManager"

This reverts commit 33e5d4ddc148eecd440f8839d09cce7853065e78.

This fixes crashes caused by receivers. | 2019-06-23 09:43:58 | 3630514a2f1b491487611adf66abb0ccbbdc6bad

Introduce faster native plugin initialization

Please read doc for METADATA_KEY_EXECUTABLE_PATH for more details.
Basically, we get around application launching limitations from Huawei (among others) by reading metadata and therefore prevent launching the application altogether.
This should hopefully fix #1091, #1106. (requires plugin app support)

This commit also refines error reporting in PluginManager. | 2019-06-19 17:43:22 | 1247c68327f5218321b1533a261cd62dd8f17d07

Make service notification more compact

This also fixes styling issue on Android Q beta 1 thru 4. | 2019-06-19 14:08:36 | 554a9b1b5df3a988db1dc2e050989021ffc90a5c

Merge pull request #2211 from shadowsocks/fix-2209

Fix #2209 | 2019-05-21 12:49:06 | 0bd0207bcf153dbb6f4d219e3238bb14cc72d4e0

Merge pull request #2181 from CzBiX/patch-1

Update faq.md | 2019-03-29 22:46:33 | fbb82c8a459d7e076309e6a162b2ba2061945172

Do not complete local resolving in IO dispatchers on Q | 2019-03-26 20:05:51 | ebda36ee194998a264914e81995e96f81e435886

Update gradle to 3.4 and fix lint | 2019-03-15 14:40:16 | 789d34ff9c2c7cf9927558337e8d63ec02727677

Ignore general exceptions from selector.select

Bug on Android 6-: https://bugs.openjdk.java.net/browse/JDK-4729342 | 2019-03-03 03:48:18 | 41aea5e3b472289b0bb674db640d251ba3e661ae

Update bug_report.md | 2019-02-24 10:28:59 | a7a16fb91a0bb5dacf00c3cdbdcc0187ad7dc1ea

Revert bad update

Remember kids, refactoring = introduced new bugs. | 2019-02-21 18:27:56 | 0345605628e0c8ae4fda06c65473ec7ad619cf7e

Handle race condition in disconnect vs callback

Our unregisterCallback is an oneway callback, meaning race conditions might happen. A quick fix is to check for callback. | 2019-02-21 16:42:07 | f10f11d4d9b5dec7d794e65a321d7d616ea93f8c

Dispatch kill executables to background | 2019-02-08 09:22:37 | 0d5834eb72097a71327c17e738600d7bcd047e4f

Finally we fix cancelling | 2019-01-31 07:02:23 | 1def9e69cee528e91f51a3fdb48d6b3dff81c455

Fix another casting bug | 2019-01-21 07:56:16 | c0ad584122d098f9d969c3a3d395a709d5a4abac

Update bug_report.md | 2018-12-29 13:22:50 | 99fd4f5f9f439383a356b1c5618d8ad6aab3c763

Merge pull request #2020 from shadowsocks/fix-bab

Fix bottom app bar | 2018-12-10 01:57:24 | 99f7283523007632c9cef47d8ec80bc023f45e62

Merge branch 'master' into fix-bab | 2018-12-07 09:35:06 | cc7bc5bf8b9281738b655d91812a1fa2948d7a16

Merge pull request #2019 from shadowsocks/revert-1990-fix-bab

Revert "Fix bottom app bar" | 2018-12-07 06:43:24 | b7827d3ca3432abbc7bcbc455887d12bede05ac8

Merge pull request #1990 from Mygod/fix-bab

Fix bottom app bar | 2018-12-07 05:07:35 | e13a4cc809136f3806252111d150b81ab4170ea7

Merge branch 'master' into fix-bab | 2018-12-07 05:07:23 | 343ecac838b7ce55b179e9bda115f0b2904ce84b

Merge pull request #1982 from xmh19936688/patch-1

don't set GOROOT if already exist | 2018-10-29 01:03:52 | d3fd0945b128eb2ae39c26fc99cfe4d0cf81730a

Revert "Remove unnecessary bypassHostnames in Acl" and fix inconsistencies of ACL file handling

This reverts commit e5cd145b2499ccf90dfd24f8d52b12ab45c4c332. Fixes #1895. | 2018-07-30 16:07:22 | fa240eaee407ad14b1587c60352f15179345d5aa

Remove obsolete fix

This bug has been fixed in 24.0.0. https://stackoverflow.com/questions/15207305/getting-the-error-java-lang-illegalstateexception-activity-has-been-destroyed#comment64093540_15656428 | 2018-07-12 09:05:33 | 1a890b12fb5dc29d1032bc0b3f620c36dae685db

Bugfix | 2018-06-11 02:47:25 | 51e57528dc7567a3f8c9f3198d2ee495c5b75672

support night theme (#1750)

* kotlin version materialdrawer

* support dark theme

* add night mode settings

* revert materialdrawer

* revert translucent style

* update dark theme color

* add night mode changed listener

* fix dependency issue

* Fix issues with bottom sheet

* Use support lib default value

* fix stat title color

* change default nightmode value

* update background color

* add night about page

* clean style

* Fix colors in selection mode in custom rules

* Fix weird AboutFragment issues

* Misc refinements

* Fix cucstom tabs colors

* Fix inconsistent color in background_profile

* Add EXTRA_NIGHT_MODE to plugin interface

* Revert changes to plugin/build.gradle

* update toolbar popupTheme | 2018-06-01 12:35:56 | e2364b14e8170813f6b8bfe7f382d43c18c9264f

Name threads for better debugging experience

Also removes an unnecessary thread. | 2018-03-30 08:04:42 | b634ef0d82525a91578c3a981cb12817814460f6

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 0af450008b021592d3a1241891f593ddfbd57b15

Implement network capabilities reporting

This commit should fix the problem where VPN connection is viewed as metered connections on Android P DP1. However as I only have an emulator to test, I can't tell if it really works but it should.

An interesting observation is that the developer can call setUnderlyingNetworks(arrayOfNulls(1)) to make the VPN connection always unmetered. This is more of a quick hack instead of a real fix. Source: https://android.googlesource.com/platform/frameworks/base/+/adbf1d0/services/core/java/com/android/server/connectivity/Vpn.java#312

One may ask whether it's possible to fix this issue for Android 8.1. The short answer is not that I know of.
After some intensive source code reading, I found out that this is the commit that "breaks" whether VPN is metered for Android 8.1: https://android.googlesource.com/platform/frameworks/base/+/43d2a1700b6eb1d804924c6a1e5e0161a13a5348%5E%21/
The key is that isActiveNetworkMetered() used to return getActiveNetworkInfo().isMetered() and now it uses the more up-to-date API getActiveNetwork(). However, getActiveNetworkInfo() ignores VPN connections while getActiveNetwork() prefers VPN connection. And since NetworkCapabilities for VPN Network is always metered by default, this ultimately causes the bug. One might be able to get around this bug by somehow calling NetworkAgent.sendNetworkCapabilities in the correct context.

Fix #1666. | 2018-03-09 06:47:58 | 3a8f863bd1f0deed081de082a674020368f30319

Enable multi-dex for debug builds

This is not a big deal thanks to min API = 21 and instant run already uses multi-dex anyways. | 2018-02-11 11:07:24 | 62375a576cdcd168302f04c7990ae3f15224c99c

Merge pull request #1593 from chon219/fix-windows-script

fixed windows build script for overture | 2018-01-22 04:58:36 | 2ef042d56b8043f2ac8b0069a4cd7c41cd1541d6

fixed windows build script for overture | 2018-01-21 10:57:20 | 0fa97f064fad5de32b24ebffd161668f13b588dd

Fix debug builds | 2018-01-19 07:10:12 | 168c0588a6ccc31be5e6a06930c655593bcc02c5

Add animation for bottom bar during Snackbar transitions

Fix #1036 the one-year-old issue.

There are still some subtle blackness during the exit animation. Unfortunately this is something I am not able to fix as I don't and probably won't ever have enough knowledge about Android's drawing passes. Anyway this still looks much better than before. | 2017-12-29 12:58:02 | 0335d67dba2f7367c537cbf5a81ecc37088ce1d2

Add more tests, fix lint errors and add check to travis | 2017-12-14 22:54:44 | 30b56c97eac761d5d80c7bc7d852d46015427cc9

Fix LocalSocketListener on debug builds

I have no idea what I'm doing. Somebody please explain. | 2017-12-07 00:57:28 | c013284b1b8d393b0e00cc750897f4fd8c6805a9

Use Gericop's preference library (#1471)

* New SimpleMenuPreference;
* More Oreo-like preference style;
* I'm tired of fixing all those bugs;
* Remove NumberPickerPreference which nobody likes. | 2017-12-01 04:10:47 | 8c33345a1feb6c1cb4cd22f912bb002c28c22a9f

Add a workaround for a support library bug | 2017-11-18 21:04:26 | 3cb6bb73b3a8137af3e1cf4f3251cb83754e5700

Lift default notification priority for VPN service

Priority has been lifted from IMPORTANCE_MIN to IMPORTANCE_LOW. This change only impacts Android 8.0 and higher.

Fixes #1431. Also fixes https://github.com/shadowsocks/shadowsocks-android/issues/1037#issuecomment-338367917. | 2017-11-15 07:50:06 | c6bb913ba248051e0b9fdd3ead5f37ed4bc4f8ec

fix fragment called onstart twice on click back

Removed irrelevant changes. | 2017-11-11 03:46:42 | 86ebbd0db5c281de4d18980521a3fb3d1251ed47

Fix the magic bug in sbt

https://stackoverflow.com/a/24860931/2245107 | 2017-10-25 23:57:44 | e79a93545b583d28ac4f9f381decda5e24b09bb0

Remove support for external scanners

I decided to remove this feature because I saw that Google Authenticator is doing the same: https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2

Also fix #1407. | 2017-10-21 03:59:24 | 9075d079d25fc570503d03261607b84ed0542c6f

Revert dm7 scanner back to 1.9.3

The latest 1.9.5 version seems to have bugs on Android O. | 2017-07-31 02:19:06 | a3f57d2557fcdf3f1a6dc76c949a268be5968e96

Replace SharedPreferences with SQLite

Other changes included:

* Fix a bug where dirty flag is not set correctly when changing per-app
  proxy settings;
* Old auto connect settings in SharedPreference is now ignored. | 2017-07-14 17:05:04 | 27fc27346cf85a1b40300efdd4402954a2609343

Remove debug info | 2017-05-05 23:30:44 | 73462b08af3978499ef798442f4c4f391a7c28d7

Add a known issue for Huawei's buggy ROM | 2017-02-02 09:22:27 | 4996d4fc5273439af10092922f52a64ee26ea6cb

Some bugfixes for new UI | 2017-01-13 18:31:01 | d5be325ab5815dc3eb35f8beaf61a9e391b32a8d

Bugfix for layout gravity | 2017-01-05 12:51:51 | af9e8c786db1a809ccfb86ae37249afbd9f3a2da

Fix a bug in serializing profile | 2016-12-24 15:25:23 | 5898d2917787c010d77ac0d672a118f28a6318c7

Layout bugfixes | 2016-12-23 17:40:55 | 25b6a307de93b762a5e3256a8c954d00e571d104

Fix a bug of profile serializing | 2016-12-20 10:15:09 | 7564ba5184dd6fe3c2a6e844a6cf465a0f915864

Boring bugfix don't look | 2016-10-12 06:56:50 | b5f655beb5796aea8a7ab2ac46141f181b835cf2

Fix Chinese locales once and for all (up to Nougat)

Seriously fix #927. From now on it will work even in Hong Kong (`/^zh-Han[st]-HK$/`) where for some reason people use Simplified Chinese and Traditional Chinese at the same time. | 2016-10-08 16:08:06 | 396d31a0a75beae6d3bd46dba22e7ce39292d9b2

Use styling to fix #910 | 2016-10-05 15:12:25 | 1d6a0b0f2b8c5762fab5496ce3b97c31ab7e315a

Don't suppress log in debug builds | 2016-09-22 13:18:02 | dd63bda2cdde0c988557a0c74b94397567d60b4e

Remove all the extravagant styles

These styles are either introduced by @AnyOfYou, or exist because of a bug in Android support library. Anyway they can be removed now. | 2016-08-19 11:49:43 | 25cfb1623a5fb9f6885c60bc9ca2f61bb91473a6

Fix SecurityException on Asus Fonepads

This is a bug of their ROMs but the documentation says:

> Must be required by a VpnService, to ensure that only the system can bind to it.
>
> Protection level: signature
>
> Constant Value: "android.permission.BIND_VPN_SERVICE"

And we have `android:exported="false"` set, so I think it's safe to remove this permission restriction. | 2016-08-09 02:45:02 | f7d422da2b5907f70fdef648325a041ca3393e71

Fix a bug in SummaryEditTextPreference | 2016-08-08 10:46:09 | 72305c5f60962f55d5d4d11981645571425d5ba8

Bugfix for previous commit | 2016-07-18 07:27:55 | b5ce7883537bb3e308b22ba23125654c106e6218

Revert "Refine #530 again and again" and probably fix #530

This reverts commit b833cb6267a56224dc9cc17093153bc8dc19d88a. | 2016-07-12 07:56:32 | c92d66d9f38ea0468f46dfa020d495537584423c

Bugfix for DropDownPreference | 2016-07-11 12:43:50 | 44625ae5b03db07b390bbb39fadfb35aa0a4c50f

Bugfix for NAT mode | 2016-07-11 11:51:47 | 159e1dff789401c66daf6c939261bbe9179cc09d

Refine #530 again

Have. To. Do. More. Refinements.

Here's what happened in the buggy versions: (I think)

* `BootReceiver` starts which invokes `Utils.startSsService` which starts `ShadowsocksRunnerService`;
* `ShadowsocksRunnerService` binds to `BaseService`;
* 1s after it's connected, it invokes `bgService.use` which returns immediately after pushing `use` in the queue since it's an oneway method;
* Then `stopSelf` => `detachService`, `BaseService` now have nothing bound to it and not started either (neither foreground nor background), so the system can destroy it any time; (at this point, `BaseService.use` isn't invoked yet)
* `com.github.shadowsocks` process then probably exits since booting is a resource-heavy task, anyway it doesn't matter;
* Some time later `com.github.shadowsocks:bg` resumes running, and `BaseService` is stopped and destroyed. Now the system is no longer aware of this `BaseService` instance but it isn't garbage collected yet;
* `use` is finally invoked;
* `startService` is invoked in `startRunner` and the destroyed background service starts running; (bug of Android?)
* `startForeground` is invoked in `ShadowsocksNotification` but the system probably refused it since the service itself is already destroyed;
* When the main activity UI is brought up and requests binding, `com.github.shadowsocks:bg` which is unaware of the existing instance of `BaseService` creates another `BaseService` and thus everything gets messed up.

This commit fixes this by invoking `getState` (which isn't an oneway method) immediately after `use` so that `ShadowsocksRunnerService` will wait for `BaseService` to start itself before destroying itself and its connection to `BaseService`. And thus its return value is not used. | 2016-07-11 11:22:54 | 84ac2b06fae97318594a6884d2fcddc38dcfe7d8

Bugfix for NumberPickerPreference | 2016-07-11 09:51:13 | dcf190c1f55d9152284136a71eb144ffa5237f81

Fix the bug where UI is not updated after importing | 2016-07-04 02:38:49 | 432ab6cc7abb98af97b6c7e890b5d96dad28cd8d

Revert "Roll back to 23.2.0 support libraries, fix #737"

This reverts commit 90e3bb312f7f860e90813c710cf4ddb077963dc3. | 2016-07-01 02:13:30 | 7e082b3e6d58096d74f63125ced396ec9d0c7489

Roll back to 23.2.0 support libraries, fix #737 | 2016-07-01 01:51:22 | 90e3bb312f7f860e90813c710cf4ddb077963dc3

Fix DeathRecipient leaking bug | 2016-05-24 03:42:12 | c878d4daa6410ab240d9de4781192c227611d94c

Quick settings tile for N preview (draft)

Addresses #671 but has NOT fixed it yet. | 2016-05-05 13:41:44 | 5966c9d8744c3816ff8d10393a0dec30bbb34bac

UI fixes

* Refine exceptions handling when parsing per-app config string

* Remove redundant profiles Preference

* Move Network Traffic to title bar

* Add ripple to title text

* Animate using animateLayoutChanges

* Hide connection test in NAT mode

* Refine UI.

* Change notification action button icon for hidpi device

* Fix FAB ripple

* Fix usability problem

* Fix changes not commited when snackbar being swiped

* Show import/export as action

* Drop unused drawables

* Move TaskerSettings

* Fix action icons

* Prevent switching to an invalid profile

* Fix line wrap when screen width is small | 2016-04-04 20:41:31 | 7d9686b5b57cbf4f153052591317bbebb99ef2ba

ParserActivity bug fixes. | 2016-03-16 16:25:13 | dd4fad1a4135f98b58d885da70652b929878ed85

Merge pull request #609 from AnyOfYou/master

Fix parser bug, add share profile by NFC. | 2016-03-16 05:46:20 | e99a0eaafca6c4001192c7cf4713902842ddc94e

Fix parser bug | 2016-03-15 17:15:17 | f792c8ebfbfd38ed198b1ac3c13c779f2be2386c

Oops fix a bug | 2016-03-11 14:53:18 | 0f2ae6521bff6b1fdc39d98c28f32437c9c1f30c

Crash recovery for NAT mode

Bugfix: when NAT process is killed, Internet access is gone. Reproduce with:

    adb shell killall com.github.shadowsocks:nat

One circumstance it cannot recover from is when updating to a new version, where both processes are killed at the same time. But a reset will be executed when the new version is launched. | 2016-03-11 12:39:01 | 8657ef87f47050e0203b49218f02e26d1fd0c11e

